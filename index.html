<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Best Restaurants in Belize</title>

    <meta name="description" content="Web GIS application,map,restaurants,Belize">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="http://192.168.58.170/arcgis_js_api/library/3.20/3.20/esri/css/esri.css">
</head>

<body>
    <!--[if lte IE 9]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <div id="mapDiv">
        <div id="legendDiv"></div>
    </div>

    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="js/main.js"></script>
    <script src="http://192.168.58.170/arcgis_js_api/library/3.20/3.20/init.js"></script>

    <script>
        dojo.require("esri.map");
        dojo.require("esri.layers.FeatureLayer");
        dojo.require("esri.dijit.Legend");

        var global = {}; //global objects
        global.urls = {
            restaurant: "http://192.168.58.170:6080/arcgis/rest/services//BelizeEdit/MapServer/0",
            belizeCountry: "http://192.168.58.170:6080/arcgis/rest/services//BelizeEdit/MapServer/1"
        }

        function startUp() {
            //create a map with an extent
            //create the spatial reference object and extent object.
            var sr = new esri.SpatialReference({
                wkid: 4326
            });
            var startExtent = new esri.geometry.Extent(-88.27, 17.47, -88.16, 17.54, sr);

            global.map = new esri.Map("mapDiv", {
                extent: startExtent
            });

            //add layers; NOTICE: outfields should be declared,默认只显示几个重要字段;
            var layerRestaurants = new esri.layers.FeatureLayer(global.urls.restaurant, {
                outFields: ["*"]
            });
            var layerBelizeCountry = new esri.layers.FeatureLayer(global.urls.belizeCountry, {
                outFields: ["*"]
            });

            global.map.addLayers([layerBelizeCountry, layerRestaurants]); //polygon layer then point layer

            //add the legend
            var legend = new esri.dijit.Legend({
                map: global.map
            }, "legendDiv");
            legend.startup();


            //define and add infotemplate to POI layer
            /*
             *1. make sure that all the to-be-showed fields should be included in featurelayer's outfields;
             *2. field name is case sensitive,use the featurelayer's exact field name;
             */
            var template = "<b>Name：<b>${name}<br>" +
                "<b>Rating：<b>[${rating}/5]<br>" +
                "<b>Offcial Website：<b><a href='${website}'>${website}</a><br>" +
                "<b>Description：<b>${description}";
            var infoTemplate = new esri.InfoTemplate("Attribute", template);
            layerRestaurants.setInfoTemplate(infoTemplate);
        }

        dojo.addOnLoad(startUp);
    </script>

    <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
    <!--
        <script>
            window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
            ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
        </script>
        <script src="https://www.google-analytics.com/analytics.js" async defer></script>
    -->
</body>

</html>
